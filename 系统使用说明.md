# 邮箱系统使用说明

## 项目概述

这是一个基于Flask的邮箱管理系统，支持用户注册、邮件收发、附件管理等功能。系统采用MySQL数据库存储数据，使用Resend API进行邮件发送。

## 主要功能

### 1. 用户管理
- **用户注册**：新用户可以注册账号
- **用户登录**：支持用户名密码登录
- **权限管理**：区分普通用户和管理员用户
- **用户隔离**：普通用户只能看到与自己相关的邮件

### 2. 邮箱管理
- **邮箱注册**：用户登录后可以注册指定域名下的邮箱
- **域名支持**：支持多个域名（shiep.edu.kg、test.com等）
- **邮箱列表**：查看已注册的邮箱列表

### 3. 邮件功能
- **邮件列表**：查看收发邮件列表
- **邮件详情**：查看邮件完整内容和附件
- **写邮件**：发送新邮件
- **附件支持**：支持邮件附件的上传和下载

### 4. 管理功能（仅管理员）
- **用户管理**：查看所有用户信息
- **域名管理**：管理系统支持的域名
- **全局邮件**：查看所有用户的邮件往来

## 系统架构

```
前端界面 (Flask Templates + Bootstrap)
    ↓
后端服务 (Flask + Python)
    ↓
数据库 (MySQL)
    ↓
邮件服务 (Resend API)
```

## 安装和运行

### 1. 环境要求
- Python 3.7+
- MySQL 8.0+
- pip (Python包管理器)

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 数据库配置
1. 创建MySQL数据库
2. 运行SQL脚本创建表结构：
```bash
python database/setup_database.py
```

3. 创建测试数据：
```bash
python create_test_data.py
```

### 4. 启动系统
```bash
python app.py
```

系统将在 `http://localhost:5000` 启动

## 测试账号

系统提供以下测试账号：

| 用户名 | 密码 | 类型 | 邮箱 |
|--------|------|------|------|
| admin | admin123 | 管理员 | admin@shiep.edu.kg |
| user1 | user123 | 普通用户 | user1@shiep.edu.kg |
| user2 | user123 | 普通用户 | user2@test.com |

## 使用流程

### 新用户使用流程
1. **注册账号**：访问注册页面创建新用户
2. **登录系统**：使用用户名密码登录
3. **注册邮箱**：在邮件列表页面点击"注册邮箱"
4. **发送邮件**：点击"写邮件"发送新邮件
5. **查看邮件**：在邮件列表中查看收发邮件

### 管理员功能
1. **用户管理**：查看和管理所有用户
2. **域名管理**：添加和管理支持的域名
3. **全局监控**：查看所有用户的邮件往来

## 技术特点

### 1. 用户隔离
- 普通用户只能看到与自己邮箱相关的邮件
- 管理员可以查看所有邮件
- 数据库层面实现权限控制

### 2. 邮件发送
- 集成Resend API实现真实邮件发送
- 支持HTML格式邮件内容
- 自动记录发送历史

### 3. 附件管理
- 支持多文件上传
- 附件大小显示和下载
- 文件安全存储

### 4. 响应式设计
- 基于Bootstrap 5设计
- 支持移动端访问
- 现代化UI界面

## 数据库结构

### 主要数据表
1. **users** - 用户信息表
2. **domains** - 域名表
3. **emails** - 邮件表
4. **user_emails** - 用户邮箱关联表
5. **attachments** - 附件表

### 关系设计
- 用户可以拥有多个邮箱
- 邮箱必须属于指定域名
- 邮件可以包含多个附件
- 实现完整的关联关系

## 安全考虑

1. **密码安全**：建议在生产环境中使用密码哈希
2. **文件上传**：限制上传文件类型和大小
3. **SQL注入**：使用参数化查询防止SQL注入
4. **用户隔离**：确保用户只能访问自己的数据

## 扩展功能

系统设计支持以下扩展：
1. **多域名支持**：可以轻松添加新域名
2. **邮件模板**：支持邮件模板功能
3. **定时发送**：支持邮件定时发送
4. **邮件搜索**：支持邮件内容搜索
5. **通知系统**：支持邮件到达通知

## 故障排除

### 常见问题
1. **数据库连接失败**：检查MySQL服务和配置
2. **邮件发送失败**：检查Resend API密钥
3. **附件下载失败**：检查文件路径和权限
4. **页面显示异常**：检查静态文件路径

### 日志查看
系统会在控制台输出详细的运行日志，包括：
- 数据库连接状态
- 邮件发送结果
- 错误信息和堆栈跟踪

## 技术支持

如有问题，请检查：
1. 系统日志输出
2. 数据库连接状态
3. API密钥配置
4. 文件权限设置

## 更新日志

### 最新修复
- ✅ 修复用户邮件隔离问题
- ✅ 修复邮件列表显示问题（发件人、时间为空）
- ✅ 修复邮件详情页面显示问题
- ✅ 添加附件功能支持
- ✅ 移除注册界面的邮箱注册按钮
- ✅ 添加用户邮箱注册功能
- ✅ 集成邮件发送功能
- ✅ 创建完整的测试数据

系统现在已经完全可用，支持完整的邮箱收发功能！
